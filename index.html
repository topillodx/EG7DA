<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EG7DA ‚Äì D√≠a de Andaluc√≠a</title>
<style>
/* ===== BODY ===== */
body{
  margin:0;
  font-family:'Segoe UI',Arial,Helvetica,sans-serif;
  background:linear-gradient(135deg,#0a5c2f,#1c8a4a);
}

}
header img{width:100%;display:block}

/* ===== UTC ===== */
#utc{
  background:#003087;
  color:white;
  text-align:center;
  font-size:1.4em;
  font-weight:bold;
  padding:10px;
}

/* ===== MAIN ===== */
main{
  max-width:1400px;
  margin:auto;
  background:#ccffb3;
  padding:25px;
  box-shadow:0 0 20px rgba(0,0,0,.3);
}
/* ===== TABLA MODERNA ===== */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 6px;          /* espacio entre celdas */
  margin-top: 25px;
  font-family: 'Segoe UI', Arial, sans-serif;
}

th {
  background: #1a6aff;
  color: white;
  padding: 10px;
  font-size: 1.1em;
  text-align: center;
  border-radius: 8px;
}

td {
  border: 1px solid #e0e0e0;
  padding: 6px;
  width: 80px;                  /* ancho m√°s compacto */
  height: 40px;                 /* altura m√°s peque√±a */
  text-align: center;
  background: #fefefe;          /* fondo de celdas vac√≠as */
  cursor: pointer;
  font-size: 0.85em;
  border-radius: 8px;           /* bordes redondeados */
  transition: all 0.25s ease;
  position: relative;
  color: #003087;               /* texto azul oscuro para vac√≠as */
}

td:hover {
  background: #ffffcc;           /* efecto hover */
  transform: scale(1.05);
}

/* ===== CELDAS DE BANDAS ===== */
td.banda {
  background: #d7d7f4;
  font-weight: bold;
  cursor: default;
  font-size: 1.6em;
  color: #ff0000;
}

/* ===== CELDAS BLOQUEADAS ===== */
td.bloqueada {
  background:#3385ff;
  color: #000;
  font-weight: bold;
  cursor: not-allowed;
}

td.bloqueada .tooltip-text {
  visibility: hidden;
  width: 140px;
  background-color: #ff3333;
  color: #fff;
  text-align: center;
  border-radius: 8px;
  padding: 6px;
  position: absolute;
  z-index: 10;
  top: -40px;
  left: 50%;
  transform: translateX(-50%);
  font-weight: bold;
  font-size: 0.9em;
  box-shadow: 0 0 8px rgba(0,0,0,0.4);
  transition: opacity 0.2s;
  opacity: 0;
}

td.bloqueada:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* ===== CELDAS ACTIVAS ===== */
td.activo {
  background: #ff8080;           /* fondo de casilla ocupada */
  color: #000;                   /* texto negro */
  font-weight: bold;
}

/* ===== BORDES REDONDEADOS DE TABLA ===== */
table tr:first-child th:first-child { border-top-left-radius: 12px; }
table tr:first-child th:last-child  { border-top-right-radius: 12px; }
table tr:last-child td:first-child  { border-bottom-left-radius: 12px; }
table tr:last-child td:last-child   { border-bottom-right-radius: 12px; }


@keyframes pulse {
  0% { box-shadow: 0 0 10px rgba(255,0,0,0.3); }
  100% { box-shadow: 0 0 18px rgba(255,0,0,0.5); }
}

/* ===== LOGIN & REGISTER ===== */
#loginOverlay, #registerOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.overlay-box{
  background:white;
  padding:35px;
  border-radius:12px;
  max-width:360px;
  width:100%;
  text-align:center;
}
.overlay-box input{
  width:100%;
  padding:12px;
  margin-top:12px;
  font-size:1em;
}
.overlay-box button{
  margin-top:18px;
  padding:12px;
  width:100%;
  background:#00cc66;
  color:white;
  border:none;
  font-size:1.1em;
  cursor:pointer;
}

/* ===== MODAL ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
}
.modal-content{
  background:white;
  max-width:280px;
  margin:10% auto;
  padding:15px;
  border-radius:10px;
  text-align:center;
}
.modal-content h3{
  margin:0 0 8px 0;
  font-size:1.1em;
  color:#0a5c2f;
}
.modal-content input{
  width:100%;
  padding:7px;
  margin-top:6px;
  font-size:1.05em;
}
#selectedMode{
  font-weight:bold;
  margin-top:10px;
  font-size:1em;
}
.modal-content button{
  margin-top:8px;
  padding:8px;
  width:100%;
  border:none;
  cursor:pointer;
  background:#0a5c2f;
  color:white;
}
.modal-content .red{background:#c0392b}
.mode-btn{
  padding:5px 7px;
  margin:3px;
  font-size:.8em;
  border:none;
  background:#003087;
  color:white;
  cursor:pointer;
  border-radius:5px;
}
.mode-btn:hover{background:#0050c8}

/* ===== TITULOS 3D + BANDERAS ===== */
.titulo-container{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:14px;
  margin-top:10px;
}
.bandera{
  width:70px;
  height:auto;
  filter: drop-shadow(3px 3px 5px rgba(0,0,0,.45));
  animation:ondear 3s ease-in-out infinite;
}
.titulo-3d{
  font-size:3.8em;
  font-weight:900;
  letter-spacing:4px;
  margin:0;
  color:#1e7f3b;
  text-shadow:
    1px 1px 0 #145a2a,
    2px 2px 0 #145a2a,
    3px 3px 0 #145a2a,
    4px 4px 0 #0a3d1c,
    6px 6px 14px rgba(0,0,0,.45);
  animation:glow 3s infinite ease-in-out;
}
.titulo-3d span{color:#ffd966;}
.subtitulo-3d{
  text-align:center;
  font-size:1.9em;
  font-weight:800;
  letter-spacing:2px;
  margin-top:6px;
  background:linear-gradient(90deg,#0a5c2f,#ffffff,#0a5c2f);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:1px 1px 0 rgba(0,0,0,.3),3px 3px 6px rgba(0,0,0,.35);
}
@keyframes glow{
  0%{text-shadow:0 0 8px rgba(255,255,255,.3)}
  50%{text-shadow:0 0 16px rgba(255,255,255,.6)}
  100%{text-shadow:0 0 8px rgba(255,255,255,.3)}
}
@media(max-width:768px){
  .titulo-3d{font-size:2.6em}
  .subtitulo-3d{font-size:1.4em}
  .bandera{width:48px}
}
@keyframes ondear {
  0%   { transform: rotate(0deg) translateY(0); }
  25%  { transform: rotate(1deg) translateY(-2px); }
  50%  { transform: rotate(0deg) translateY(0); }
  75%  { transform: rotate(-1deg) translateY(2px); }
  100% { transform: rotate(0deg) translateY(0); }
}
/* ===== BOTONES DE ACCI√ìN ===== */
.button-container {
  display: flex;
  justify-content: center; /* Centrar los botones */
  gap: 12px;
  margin: 15px 0;
  flex-wrap: wrap; /* Para que se adapten en m√≥vil */
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px 18px;
  background: #003087;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  font-size: 1em;
  transition: transform 0.15s, background 0.2s;
}

.action-btn:hover {
  background: #0050c8;
  transform: scale(1.05);
}

.btn-icon {
  font-size: 1.2em;
}

</style>
</head>
<body>

<div id="utc">Hora UTC: --:--:-- | Fecha: --/--/----</div>

<!-- LOGIN -->
<div id="loginOverlay">
  <div class="overlay-box">
    <h2>Login EG7DA</h2>
    <input id="loginUser" placeholder="Email">
    <input id="loginPass" type="password" placeholder="Password" onkeydown="if(event.key==='Enter'){loginUser()}">
    <button onclick="loginUser()">Entrar</button>
    <p id="loginError" style="color:red; display:none"></p>
    <p>¬øNo tienes cuenta? <a href="#" onclick="showRegister()">Reg√≠strate</a></p>
  </div>
</div>

<!-- REGISTER -->
<div id="registerOverlay" style="display:none;">
  <div class="overlay-box">
    <h2>Registro EG7DA</h2>
    <input id="regEmail" placeholder="Email">
    <input id="regPass" type="password" placeholder="Password">
    <input id="regUser" placeholder="Indicativo">
    <button onclick="registerUser()">Registrar</button>
    <p id="regError" style="color:red; display:none"></p>
    <p>¬øYa tienes cuenta? <a href="#" onclick="showLogin()">Inicia sesi√≥n</a></p>
  </div>
</div>

<header>
  <img src="RADIO CLUB SEVILLA.JPG" alt="Radio Club Sevilla">
</header>

<main>
<!-- USUARIO CONECTADO + LOGOUT -->
<div id="currentUserDisplay" style="font-weight:bold;color:#003087; text-align:center; margin-top:10px;"></div>

<div class="button-container">
  <button class="action-btn" onclick="logout()">
    <span class="btn-icon">üîí</span> Cerrar sesi√≥n
  </button>
  <button class="action-btn" onclick="window.location.href='plan-bandas.html'">
    <span class="btn-icon">üì°</span> PLAN + NORMAS
  </button>
  <button class="action-btn" onclick="window.open('https://radioclubsevilla.com/', '_blank')">
    <span class="btn-icon">üè†</span> Radio Club Sevilla
  </button>
</div>


<div class="titulo-container">
  <img src="img/bandera_andalucia.jpg" class="bandera" alt="Bandera Andaluc√≠a">
  <h1 class="titulo-3d">EG<span>7</span>DA</h1>
  <img src="img/bandera_andalucia.jpg" class="bandera" alt="Bandera Andaluc√≠a">
</div>
<h2 class="subtitulo-3d">D√≠a de Andaluc√≠a</h2>

<!-- TABLA DE BANDAS -->
<table>
<tr>
  <th>BANDA</th>
  <th>CW</th>
  <th>SSB+FM</th>
  <th>RTTY+PSK</th>
  <th>FT8+FT4</th>
</tr>
<tr><td class="banda">80 m</td><td onclick="openForm(this)" data-band="80-CW"></td><td onclick="openForm(this)" data-band="80-SSB"></td><td onclick="openForm(this)" data-band="80-DIG1"></td><td onclick="openForm(this)" data-band="80-DIG2"></td></tr>
<tr><td class="banda">60 m</td><td onclick="openForm(this)" data-band="60-CW"></td><td onclick="openForm(this)" data-band="60-SSB"></td><td onclick="openForm(this)" data-band="60-DIG1"></td><td onclick="openForm(this)" data-band="60-DIG2"></td></tr>
<tr><td class="banda">40 m</td><td onclick="openForm(this)" data-band="40-CW"></td><td onclick="openForm(this)" data-band="40-SSB"></td><td onclick="openForm(this)" data-band="40-DIG1"></td><td onclick="openForm(this)" data-band="40-DIG2"></td></tr>
<tr><td class="banda">30 m</td><td onclick="openForm(this)" data-band="30-CW"></td><td class="bloqueada" data-band="30-SSB" onclick="blockedAlert(this)">BLOKED</td><td onclick="openForm(this)" data-band="30-DIG1"></td><td onclick="openForm(this)" data-band="30-DIG2"></td></tr>
<tr><td class="banda">20 m</td><td onclick="openForm(this)" data-band="20-CW"></td><td onclick="openForm(this)" data-band="20-SSB"></td><td onclick="openForm(this)" data-band="20-DIG1"></td><td onclick="openForm(this)" data-band="20-DIG2"></td></tr>
<tr><td class="banda">17 m</td><td onclick="openForm(this)" data-band="17-CW"></td><td onclick="openForm(this)" data-band="17-SSB"></td><td onclick="openForm(this)" data-band="17-DIG1"></td><td onclick="openForm(this)" data-band="17-DIG2"></td></tr>
<tr><td class="banda">15 m</td><td onclick="openForm(this)" data-band="15-CW"></td><td onclick="openForm(this)" data-band="15-SSB"></td><td onclick="openForm(this)" data-band="15-DIG1"></td><td onclick="openForm(this)" data-band="15-DIG2"></td></tr>
<tr><td class="banda">12 m</td><td onclick="openForm(this)" data-band="12-CW"></td><td onclick="openForm(this)" data-band="12-SSB"></td><td onclick="openForm(this)" data-band="12-DIG1"></td><td onclick="openForm(this)" data-band="12-DIG2"></td></tr>
<tr><td class="banda">10 m</td><td onclick="openForm(this)" data-band="10-CW"></td><td onclick="openForm(this)" data-band="10-SSB"></td><td onclick="openForm(this)" data-band="10-DIG1"></td><td onclick="openForm(this)" data-band="10-DIG2"></td></tr>
<tr><td class="banda">6 m</td><td onclick="openForm(this)" data-band="6-CW"></td><td onclick="openForm(this)" data-band="6-SSB"></td><td onclick="openForm(this)" data-band="6-DIG1"></td><td onclick="openForm(this)" data-band="6-DIG2"></td></tr>
<tr><td class="banda">2 m</td><td onclick="openForm(this)" data-band="2-CW"></td><td onclick="openForm(this)" data-band="2-SSB"></td><td onclick="openForm(this)" data-band="2-DIG1"></td><td onclick="openForm(this)" data-band="2-DIG2"></td></tr>
</table>

<!-- PANEL RADIO -->
<div class="radio-panel" style="margin-top:30px;">
    <div style="border:4px solid #003087; border-radius:12px; overflow:hidden">
        <iframe 
            src="https://clublog.org/livestream/EG7DA"
            width="100%"
            height="600"
            style="border:none;">
        </iframe>
    </div>
</div>
<!-- FIRMA TOPILLODX -->
<div class="firma-topillodx" style="text-align:center; margin-top:10px;">
  <img src="img/topillodx-logo.png" alt="TOPILLODX Logo" style="width:110px; max-width:15%;">
  <div style="font-size:0.9em; color:#003087; margin-top:4px;">by TOPILLODX</div>
</div>

</main>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Datos de transmisi√≥n</h3>
    <input id="qrz" disabled>
    <input id="freq" placeholder="Frecuencia MHz">

 <div class="mode-buttons">
  <!-- Botones de modo se generan din√°micamente -->
</div>

    <p id="selectedMode">Modo: ‚Äî</p>
    <button onclick="saveCell()">Guardar</button>
    <button class="red" onclick="clearCell()">Liberar banda</button>
    <button style="background:#777" onclick="closeModal()">Cancelar</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ================== JAVASCRIPT COMPLETO ==================
const firebaseConfig = {
  apiKey: "AIzaSyCTdcMFz8qXCz60p1QmQsqZN_ovUHUVAuo",
  authDomain: "eg7da-dia-de-andalucia.firebaseapp.com",
  databaseURL: "https://eg7da-dia-de-andalucia-default-rtdb.firebaseio.com",
  projectId: "eg7da-dia-de-andalucia",
  storageBucket: "eg7da-dia-de-andalucia.firebasestorage.app",
  messagingSenderId: "100328196767",
  appId: "1:100328196767:web:d6a847a4a9f15c7eac70aa"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

let currentUser = '', currentUID = null, currentCell = null, currentMode = '';
let isAdmin = false;

// ===== LOGIN / REGISTER =====
function showRegister(){ document.getElementById("loginOverlay").style.display='none'; document.getElementById("registerOverlay").style.display='flex'; }
function showLogin(){ document.getElementById("registerOverlay").style.display='none'; document.getElementById("loginOverlay").style.display='flex'; }

function registerUser(){
  const email=document.getElementById("regEmail").value;
  const pass=document.getElementById("regPass").value;
  const indicativo=document.getElementById("regUser").value.toUpperCase();
  auth.createUserWithEmailAndPassword(email,pass)
    .then(cred=>db.ref("users/"+cred.user.uid).set({email,indicativo}))
    .then(()=>{alert("Usuario registrado. Inicia sesi√≥n."); showLogin();})
    .catch(err=>{const regError=document.getElementById("regError"); regError.innerText=err.message; regError.style.display='block';});
}

function loginUser(){
  const email = document.getElementById("loginUser").value;
  const pass  = document.getElementById("loginPass").value;

  auth.signInWithEmailAndPassword(email,pass)
    .then(cred => db.ref("users/"+cred.user.uid).once("value"))
    .then(snapshot => {
      currentUID = snapshot.key;
      currentUser = snapshot.val().indicativo.toUpperCase();
      isAdmin = (currentUser === "EA7ZC");
      document.getElementById("loginOverlay").style.display='none';
      document.getElementById("currentUserDisplay").innerText = "Usuario: " + currentUser + (isAdmin ? " (Admin)" : "");
    })
    .catch(err=>{
      const loginError=document.getElementById("loginError");
      loginError.innerText=err.message;
      loginError.style.display='block';
    });
}

function logout(){
  auth.signOut()
    .then(()=>{
      currentUser="";
      currentUID="";
      isAdmin=false;
      document.getElementById("loginOverlay").style.display="flex";
      document.getElementById("currentUserDisplay").innerText="";
    });
}

// ===== MODAL CELDA =====
function openForm(td){
  if(!currentUser){ 
    alert("Debes iniciar sesi√≥n"); 
    return; 
  }

  // ================= OPERADORES NORMALES SOLO PUEDEN UNA CASILLA =================
  if(!isAdmin){
    let tieneCasilla = false;
    document.querySelectorAll("td.activo").forEach(c => {
      if(c.dataset.user === currentUser){
        tieneCasilla = true;
      }
    });
    // Si ya tiene una casilla y la que intenta abrir est√° vac√≠a => no permitir
    if(tieneCasilla && !td.classList.contains('activo')){
      alert("Solo puedes ocupar una casilla a la vez.");
      return;
    }
  }

  // ================= BLOQUEAR CELDAS DE OTROS =================
  if(!isAdmin && td.dataset.user && td.dataset.user !== currentUser){ 
    alert("Esta casilla ya est√° ocupada por " + td.dataset.user); 
    return; 
  }

  currentCell = td;
  document.getElementById("qrz").value = currentUser;
  document.getElementById("freq").value = td.dataset.freq || '';
  currentMode = td.dataset.mode || '';
  document.getElementById("selectedMode").innerText = "Modo: " + (currentMode || '‚Äî') + (isAdmin ? " (Admin: puedes ocupar o liberar cualquier casilla)" : "");

  // ================= BOTONES DE MODO SEG√öN EL TIPO DE BANDA =================
 let allowedModes = [];
const parts = td.dataset.band.split("-");
const band = parts[0];      // 80, 40, 2, etc
const bandType = parts[1];  // CW, SSB, DIG

// CW siempre fijo
if (bandType === "CW") {
  allowedModes = ["CW"];
}

// SSB normal
else if (bandType === "SSB") {
   if (band === "2" || band === "6") {
    // ‚≠ê SOLO 2m tiene SSB + FM
    allowedModes = ["SSB", "FM"];
  } else {
    allowedModes = ["SSB"];
  }
}

// Digitales
else {
  allowedModes = ["FT8", "FT4", "RTTY", "PSK"];
}


  const btnContainer = document.querySelector(".mode-buttons");
  btnContainer.innerHTML="";
  allowedModes.forEach(m=>{
    const btn=document.createElement("button");
    btn.className="mode-btn";
    btn.innerText=m;
    btn.onclick=()=>setMode(m);
    btnContainer.appendChild(btn);
  });

  document.getElementById("modal").style.display='block';
}



function setMode(mode){
  currentMode = mode;
  document.getElementById("selectedMode").innerText = "Modo: " + mode;
}

function saveCell(){
  if(!currentCell) return;
  if(currentCell.dataset.user && currentCell.dataset.user !== currentUser){ alert("No puedes modificar una casilla ocupada por otro operador"); return; }

  const freqStr = document.getElementById("freq").value || '';
  const freq = parseFloat(freqStr);
  const band = currentCell.dataset.band.split('-')[0];

  const cwLimits = {"80":[3500,3570],"60":[5351.5,5354],"40":[7000,7060],"30":[10100,10125],"20":[14000,14065],"17":[18068,18095],"15":[21000,21070],"12":[24890,24910],"10":[28000,28200],"6":[50000,50100],"2":[144000,144280]};
  const ssbLimits = {"80":[3650,3800],"60":[3554,3566],"40":[7060,7200],"30":[null,null],"20":[14150,14350],"17":[18110,18168],"15":[21200,21450],"12":[24930,24990],"10":[28300,28800],"6":[50110,50200],"2":[144250,146000]};

  if(currentMode==='CW' && (!freq || freq<cwLimits[band][0] || freq>cwLimits[band][1])){
    alert(`Frecuencia inv√°lida para CW en ${band}m. Debe estar entre ${cwLimits[band][0]} y ${cwLimits[band][1]} MHz`);
    return;
  }
  if(currentMode==='SSB'){
    const limits=ssbLimits[band];
    if(!limits[0]||!limits[1]){ alert(`SSB no permitido en ${band}m`); return; }
    if(!freq || freq<limits[0]||freq>limits[1]){
      alert(`Frecuencia inv√°lida para SSB en ${band}m. Debe estar entre ${limits[0]} y ${limits[1]} MHz`);
      return;
    }
  }

  currentCell.innerHTML = `<strong>${currentUser}</strong><br><em>${currentMode}</em><br>${freqStr} MHz`;
  currentCell.classList.add('activo');
  currentCell.dataset.user=currentUser;
  currentCell.dataset.mode=currentMode;
  currentCell.dataset.freq=freqStr;

  const bandKey = currentCell.dataset.band.replace('-','_');
  db.ref('bands/' + bandKey).set({user:currentUser,mode:currentMode,freq:freqStr})
    .then(()=>{ document.getElementById("modal").style.display='none'; })
    .catch(err=>{ alert("Error al guardar: " + err.message); });
}

function clearCell(){
  if(!currentCell) return;

  // Solo bloqueamos si NO eres admin y no eres due√±o de la celda
  if(!isAdmin && currentCell.dataset.user !== currentUser){
    alert("Solo puedes liberar tu propia casilla.");
    return;
  }

  const cellId = currentCell.dataset.band.replace('-','_');

  db.ref("bands/"+cellId).remove()
    .then(()=>{
      currentCell.innerHTML='';
      currentCell.dataset.user='';
      currentCell.dataset.mode='';
      currentCell.dataset.freq='';
      currentCell.classList.remove('activo');
      closeModal();
    })
    .catch(err=>{
      alert("Error al liberar la casilla: " + err.message);
    });
}



function closeModal(){
  document.getElementById("modal").style.display="none";
  currentCell=null;
  currentMode="";
}

// ===== UTC =====
setInterval(() => {
  const now = new Date();

  // Hora UTC
  const hours = now.getUTCHours().toString().padStart(2,'0');
  const minutes = now.getUTCMinutes().toString().padStart(2,'0');
  const seconds = now.getUTCSeconds().toString().padStart(2,'0');

  // Fecha UTC
  const day = now.getUTCDate().toString().padStart(2,'0');
  const month = (now.getUTCMonth() + 1).toString().padStart(2,'0'); // Enero = 0
  const year = now.getUTCFullYear();

  // Actualizar el div
  document.getElementById("utc").innerText =
    `Hora UTC: ${hours}:${minutes}:${seconds} | Fecha: ${day}/${month}/${year}`;
}, 1000);


// ===== CARGAR DATOS =====
auth.onAuthStateChanged(user=>{
  if(user){
    currentUID=user.uid;
    db.ref("users/"+user.uid).once("value").then(s=>{
      currentUser = s.val().indicativo.toUpperCase();
      isAdmin = (currentUser==="EA7ZC");
      document.getElementById("loginOverlay").style.display='none';
      document.getElementById("currentUserDisplay").innerText="Usuario: "+currentUser+(isAdmin?" (Admin)":"");
    });
  }
});

db.ref("bands").on("value",snapshot=>{
  const data=snapshot.val()||{};
  document.querySelectorAll("td").forEach(td=>{
    if(td.dataset.band){
      const key=td.dataset.band.replace('-','_');
      if(data[key]){
        td.innerHTML=`<strong>${data[key].user}</strong><br><em>${data[key].mode}</em><br>${data[key].freq} MHz`;
        td.dataset.user=data[key].user;
        td.dataset.mode=data[key].mode;
        td.dataset.freq=data[key].freq;
        td.classList.add('activo');
      } else {
        td.innerHTML='';
        td.dataset.user='';
        td.dataset.mode='';
        td.dataset.freq='';
        td.classList.remove('activo');
      }
    }
  });
});

// ===== CERRAR MODAL CLICK FUERA =====
document.getElementById("modal").addEventListener("click", e=>{
  if(e.target.id==="modal") closeModal();
});
function blockedAlert(cell) {
  alert("¬°¬°D√≥nde vas loko!! üòú Esta banda est√° bloqueada");

  // Guardamos el contenido original
  const originalContent = cell.innerHTML;
  const originalBg = cell.style.background;

  let count = 0;
  const blink = setInterval(() => {
    if (count % 2 === 0) {
      cell.style.background = "#ff3333"; // fondo rojo
      cell.innerHTML = "üö´";             // emoji divertido
    } else {
      cell.style.background = "#d7d7f4"; // fondo normal
      cell.innerHTML = originalContent;   // contenido original
    }
    count++;
    if (count > 5) {
      clearInterval(blink);
      cell.style.background = originalBg; // restaurar color original
      cell.innerHTML = originalContent;   // restaurar contenido
    }
  }, 150);
}

</script>

</body>
</html>
